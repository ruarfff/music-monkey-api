# MusicMonkey API

[ ![Codeship Status for ruairitobrien/music-monkey-api](https://app.codeship.com/projects/a0accad0-27bb-0136-a7af-76568d97e0d2/status?branch=master)](https://app.codeship.com/projects/287091)

The project is generated by [LoopBack](http://loopback.io) __BUT__ doesn't really use anything from Loopback. This is a bad thing of course and should be sorted out. I was told Loopback was a great way to bootstrap a new service but I hit a number of issues. One big one is lack of any real support for DynamoDB. I just went with hitting DynamoDB directly and not hooking in with Loopback and have yet to resolve that. This in turn has made me basically build an Express app that just happens to depend on Loopback too. I am a bad person for doing this and I apologise.

## Developing locally

You need to have 2 terminals open for this unfortunately TODO: Write a better run script! It gets really annoying when you forget to compile first and wonder why your changes aren't showing up when you run `yarn start`

This app uses typescript so yu need to kick off a compile job:

`yarn compile`

If you want the compile to run automatically on each change use this:

`yarn compile:watch`

To run the app locally use:

`yarn start`

This will launch the application on [localhost:8080](http://localhost:8080)

To restart the app automatically on changes:

`yarn start:watch`

The easiest things is to use 2 consoles.

In one run: `yarn compile:watch` and in the other run: `yarn start:watch`

## Deploying

Deployments are automated. We use [CodeShip](https://codeship.com/) to automate deployments. All you need to do is push changes to the master branch to deploy. Other branches will not deploy.

See the build badge at the top of this Readme for more.

Once deployed the app is available at [https://api.musicmonkey.io](api.musicmonkey.io)


## Troubleshooting

If you get an annoying Dtrace error running the app on a Mac, this helped:

[node-gyp issue](https://github.com/nodejs/node-gyp/issues/569)

In my case that was:
```bash
xcode-select --install # Install Command Line Tools if you haven't already.
sudo xcode-select --switch /Library/Developer/CommandLineTools # Enable command line tools
sudo xcode-select -s /Applications/Xcode.app/Contents/Developer
```

Followed by:

```bash
yarn global add node-gyp
rm -rf node_modules yarn.lock
yarn install
```

#### Debugging in VSCode

in `.vscode/launch.json`
```
{
  "version": "0.2.0",
  "configurations": [
      {
          "type": "node",
          "request": "launch",
          "name": "Launch Program",
          "program": "${workspaceFolder}/build/server/server.js"
      }
  ]
}
```
